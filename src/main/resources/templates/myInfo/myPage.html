<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="naver-site-verification" content="9d4ada4a32e188c9c5e42e8a751c4f497033d0c7"/>
  <link rel="shortcut icon" href="/static/assets/images/favicon.ico"/>
  <link rel="stylesheet" type="text/css" href="/static/assets/js/slick.min.css"/>
  <link rel="stylesheet" type="text/css" href="/static/assets/js/slick.min.js"/>
  <link rel="stylesheet" type="text/css" href="/static/assets/js/slick-theme.min.css"/>
  <script type="text/javascript" src="/static/assets/js/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="/static/assets/js/jquery-migrate-1.2.1.min.js"></script>
  <script type="text/javascript" src="/static/assets/js/polyfill.min.js"></script>
  <script type="text/javascript" src="/static/assets/js/kakao.js"></script>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=8f23556bd57117a96842def422603994"></script>
  <script type="text/javascript" src="/static/assets/js/ua-parser.min.js"></script>
  <script type="text/javascript" src="/static/assets/js/react.production.min.js"></script>
  <script type="text/javascript" src="/static/assets/js/react-copy-to-clipboard.js"></script>

  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1"/>
  <meta charSet="utf-8"/>

  <meta name="next-head-count" content="11"/>
  <link rel="preload" href="/_next/static/r96-BCZo64C9PGBuAtZ98/pages/petsitters.js" as="script"/>
  <link rel="preload" href="/_next/static/r96-BCZo64C9PGBuAtZ98/pages/_app.js" as="script"/>
  <link rel="preload" href="/_next/static/runtime/webpack-4b444dab214c6491079c.js" as="script"/>
  <link rel="preload" href="/_next/static/chunks/commons.58cd47c941173809d3d8.js" as="script"/>
  <link rel="preload" href="/_next/static/chunks/styles.d2c14889900d80d21002.js" as="script"/>
  <link rel="preload" href="/_next/static/runtime/main-0ee1c1962f44d8fad7d7.js" as="script"/>
  <link rel="stylesheet" href="/_next/static/css/styles.f53a334d.chunk.css"/>
  <link rel="stylesheet" href="/_next/static/css/static/r96-BCZo64C9PGBuAtZ98/pages/_app.js.548dbefb.chunk.css"/>
</head>

<style>
  .dropdown{
    position : relative;
    display : inline-block;
  }

  .dropdown-content{
    display : none;
    position : absolute;
    z-index : 1; /*다른 요소들보다 앞에 배치*/
    font-weight: 400;
    background-color: #f9f9f9;
    min-width : 200px;
  }

  .dropdown-content a{
    display : block;
    text-decoration : none;
    color : rgb(37, 37, 37);
    font-size: 12px;
    padding : 12px 20px;
  }

  .dropdown-content a:hover{
    background-color : #ececec
  }

  .dropdown:hover .dropdown-content {
    display: block;
  }

  .form-control {
    height: 40px;
    border: 1px solid #adb5bd;
    border-radius: 5px;
  }

  .mb-2 {
    display: flex;
    flex-direction: column;
    justify-content: center;
    margin-top: 20px;
  }

  .form-label {
    font-weight: bold;
    font-size: 16px;
    color: #2d353d;
    margin-bottom: 12px;
  }

  .text-end {
    margin-top: 30px;
    display: flex;
    justify-content: center;
  }

  .text-end button{
    font-size: 18px;
    font-weight: bold;
    color: rgb(113, 162, 255);
    background-color: white;
    width: 150px;
    height: 55px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1.5px solid rgb(113, 162, 255);
    border-radius: 28px;
    box-shadow: rgb(0 0 0 / 3%) 0px 3px 3px -3px;
    cursor: pointer;

  }
</style>

<body>
<div th:replace="/common/header.html :: fragment-header"></div>
<div id="body-wrapper" class="wrapper">
  <div id ="body-content">
        <div id="service-container">
          <div class="desktop hidden-s">
            <div>
              <div style="width:100%;display:flex;justify-content:center;flex-direction:column;align-items:center; padding-bottom:85px;border-bottom:1px solid #E7E9EB;box-shadow:0 2px 20px rgba(0,0,0,0.05)">
                <div style="justify-content:center;align-items:center;margin-top:50px;position:relative; width: 500px">
                  <form id="userInputs" name="userInputs">
                    <h3 class="mb-3 text-uppercase bg-light p-2"> 내 정보</h3>

                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-2">
                          <label for="name" class="form-label">이름</label>
                          <input type="text" class="form-control" id="name" disabled>
                        </div>
                      </div>
                    </div> <!-- end row -->

                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-2">
                          <label for="id" class="form-label">이메일 아이디</label>
                          <input type="text" class="form-control" id="id" disabled>
                        </div>
                      </div>
                    </div> <!-- end row -->

                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-2">
                          <label for="phone" class="form-label">전화번호</label>
                          <input type="text" class="form-control" id="phone">
                        </div>
                      </div>
                    </div> <!-- end row -->

                    <div class="row">
                      <div class="col-12">
                        <div class="mb-2">
                          <label class="form-label">주소</label>
                          <input type="text" id="sample6_postcode" placeholder="우편번호" style="height: 40px; border-radius: 5px; border-color: #adb5bd; margin-bottom: 5px;">
                          <input type="button" onclick="sample6_execDaumPostcode()" value="우편번호 찾기" ><br>
                          <input type="text" id="sample6_address" placeholder="주소" style="height: 40px; border-radius: 5px; border-color: #adb5bd; margin-bottom: 5px;"><br>
                          <input type="text" id="sample6_detailAddress" placeholder="상세주소" style="height: 40px; border-radius: 5px; border-color: #adb5bd; margin-bottom: 5px;">
                          <input type="text" id="sample6_extraAddress" placeholder="참고항목" style="height: 40px; border-radius: 5px; border-color: #adb5bd; margin-bottom: 10px;" value="참고항목">
<!--                          <input type="text" class="form-control" id="address">-->
                          <div id="wrap" style="display:none;border:1px solid;width:500px;height:300px;margin:5px 0;position:relative">
                            <img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap" style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldDaumPostcode()" alt="접기 버튼">
                          </div>
                        </div>
                      </div> <!-- end col -->
                    </div> <!-- end row -->

                    <div class="text-end">
                      <button type="button" class="btn btn-success waves-effect waves-light mt-2" th:onclick="save()">수정하기</button>
                    </div>
                  </form>

                </div>
              </div>
            </div>
          </div>
        </div>
  </div>
</div>

<footer class="ft">
  <script>document.write(new Date().getFullYear())</script> &copy; Minton theme by <a href="" class="text-dark">Coderthemes</a>
</footer>


<script async="" data-next-page="/petsitters" src="/_next/static/r96-BCZo64C9PGBuAtZ98/pages/petsitters.js"></script>
<script async="" data-next-page="/_app" src="/_next/static/r96-BCZo64C9PGBuAtZ98/pages/_app.js"></script>
<script src="/_next/static/runtime/webpack-4b444dab214c6491079c.js" async=""></script>
<script src="/_next/static/chunks/commons.58cd47c941173809d3d8.js" async=""></script>
<script src="/_next/static/chunks/styles.d2c14889900d80d21002.js" async=""></script>
<script src="/_next/static/runtime/main-0ee1c1962f44d8fad7d7.js" async=""></script>

<script src="/static/assets/js/toy-common.js"></script>
<script src="/static/assets/js/toy-error.js"></script>

<!-- 카카오 주소 API -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
  function sample6_execDaumPostcode() {
    new daum.Postcode({
      oncomplete: function(data) {
        // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

        // 각 주소의 노출 규칙에 따라 주소를 조합한다.
        // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
        var addr = ''; // 주소 변수
        var extraAddr = ''; // 참고항목 변수

        //사용자가 선택한 주소 타입에 따라 해당 주소 값을 가져온다.
        if (data.userSelectedType === 'R') { // 사용자가 도로명 주소를 선택했을 경우
          addr = data.roadAddress;
        } else { // 사용자가 지번 주소를 선택했을 경우(J)
          addr = data.jibunAddress;
        }

        // 사용자가 선택한 주소가 도로명 타입일때 참고항목을 조합한다.
        if(data.userSelectedType === 'R'){
          // 법정동명이 있을 경우 추가한다. (법정리는 제외)
          // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
          if(data.bname !== '' && /[동|로|가]$/g.test(data.bname)){
            extraAddr += data.bname;
          }
          // 건물명이 있고, 공동주택일 경우 추가한다.
          if(data.buildingName !== '' && data.apartment === 'Y'){
            extraAddr += (extraAddr !== '' ? ', ' + data.buildingName : data.buildingName);
          }
          // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
          if(extraAddr !== ''){
            extraAddr = ' (' + extraAddr + ')';
          }
          // 조합된 참고항목을 해당 필드에 넣는다.
          document.getElementById("sample6_extraAddress").value = extraAddr;

        } else {
          document.getElementById("sample6_extraAddress").value = '';
        }

        // 우편번호와 주소 정보를 해당 필드에 넣는다.
        document.getElementById('sample6_postcode').value = data.zonecode;
        document.getElementById("sample6_address").value = addr;
        // 커서를 상세주소 필드로 이동한다.
        document.getElementById("sample6_detailAddress").focus();
      }
    }).open();
  }
</script>

<script>
  $(() => {
    getInfo()
  })

  function getInfo() {
    toy.apiCall({
      type:'POST',
      url: 'http://localhost:8079/api/v1/user/myPage',
      success: (result) => {
        console.log("result"+result.data)
        setUserInfo(result.data);
      },
      successError: (result) => {
        if(result.subCode === 2004){ //엑세스 토큰 만료
          toy.access({
            success: (result) => {
              console.log(">>>>>>>>>>>>>>>>>>>>>>성공 응답을 받았다면 다시 요청")
              getInfo()
            },
            successError: (result) => {
              toyError.setAlert(result);
            }
          });
        } else {
          toyError.setAlert(result);
        }
      }
    })
  }


  function setUserInfo(data) {
    $("#name").val(data.name);
    $("#id").val(data.email);
    $("#phone").val(data.phone);
    $("#sample6_postcode").val(data.zip_code);
    $("#sample6_address").val(data.address);
    $("#sample6_detailAddress").val(data.address_detail);
  }

  function save() {
    let userForm = document.getElementById('userInputs');
    let userData = Array.from(userForm.elements)
    let userFormData ={};

    for(let tag of userData) {
      if(tag.tagName ==="INPUT" && tag.value === '') {
        alert('모든 값을 입력해주세요.');
        return tag.focus();
      } else if(tag.tagName ==='INPUT') userFormData[tag.id] = tag.value
    }

    console.log(">>>>>>>>>>>>>>>name"+userFormData.name)
    console.log(">>>>>>>>>>>>>>>email"+userFormData.id)
    console.log(">>>>>>>>>>>>>>>phone"+userFormData.phone)
    console.log(">>>>>>>>>>>>>>>sample6_postcode"+userFormData.sample6_postcode)
    console.log(">>>>>>>>>>>>>>>sample6_address"+userFormData.sample6_address)
    console.log(">>>>>>>>>>>>>>>sample6_detailAddress"+userFormData.sample6_detailAddress)

    toy.apiCall({
      type: 'POST',
      url: 'http://localhost:8079/api/v1/user/saveUserInfo',
      data: {
        phone: userFormData.phone,
        zipCode: userFormData.sample6_postcode,
        address: userFormData.sample6_address,
        addressDetail: userFormData.sample6_detailAddress
      },
      success: (result) => {
        alert("수정되었습니다")
      },
      successError: (result) => {
        if(result.subCode === 2004){ //엑세스 토큰 만료
          toy.access({
            success: (result) => {
              console.log(">>>>>>>>>>>>>>>>>>>>>>성공 응답을 받았다면 다시 요청")
              getInfo()
            },
            successError: (result) => {
              toyError.setAlert(result);
            }
          });
        } else {
          toyError.setAlert(result);
        }
      }
    })

  }

</script>


</body>


</html>
